"use strict";!function(e,t){if("ymab"in e&&"function"==typeof e.ymab&&e.ymab.inited)return;let n,r,o,i;!function(e){e.CssInsert="css-insert",e.TextInsert="text-insert",e.Href="href-insert",e.ImageSrc="image-insert",e.Html="html-replace",e.JS="js-insert"}(n||(n={})),function(e){e.LocalStorage="localstorage",e.Cookie="cookie",e.GetParam="get"}(r||(r={})),function(e){e.ExpFlags="ab__exp_flags",e.RedirParam="vq__redir_param",e.RedirParamNew="vq__redirect_param"}(o||(o={})),function(e){e.Init="init",e.Param="getParam",e.Flags="getFlags",e.Experiments="getExperiments",e.SetConfig="setConfig",e.GetConfig="getConfig"}(i||(i={}));const a={},s={},c={},l={enableRedir:!0,enableVisual:!0,enableHTML:!0,enableJS:!1,enableWatch:!1,storeRedirParam:!0,metrikaTimeout:100,nonce:void 0},u={enableRedir:["boolean"],enableVisual:["boolean"],enableHTML:["boolean"],enableJS:["boolean"],enableWatch:["boolean"],metrikaTimeout:["number"],storeRedirParam:["boolean","string"],nonce:["string"]},f={};let m="https://uaas.yandex.ru/v1/exps/";const d="_ymab_param",h=31536e6,p=/\/$/;let g;function b(e,n,r=h){const o=new Date(Date.now()+r).toUTCString();t.cookie=`${e}=${n}; path=/; expires=${o};`}function y(e){const n=new RegExp(`(?:^|; )${e}=([^;]*)`),r=t.cookie.match(n);return r&&r[1]||void 0}function v(e,t){const n=e.indexOf(t);if(-1===n)return[];return[e.slice(0,n).trim(),e.slice(n+1)]}function x(e,t){return e.reduce(((e,{t:r,n:o,v:i})=>{function a(){let t=e.flags[o];t||(e.flags[o]=t=[]),t.push(i)}if("visual"===r&&t.enableVisual){const[r,s]=v(i,"|");if(!r||void 0===s)return e;switch(o){case n.CssInsert:e.cssInsert.push({selector:r,value:s});break;case n.TextInsert:e.textInsert.push({selector:r,value:s});break;case n.Href:e.hrefInsert.push({selector:r,value:s});break;case n.ImageSrc:e.imageSrcInsert.push({selector:r,value:s});break;case n.Html:t.enableHTML?e.htmlReplace.push({selector:r,value:s}):a();break;case n.JS:t.enableJS?e.jsInsert.push({selector:r,value:s}):a()}return e}return"redir"===r&&t.enableRedir?(e.redirect.push(i),e):(a(),e)}),{cssInsert:[],textInsert:[],redirect:[],hrefInsert:[],imageSrcInsert:[],htmlReplace:[],jsInsert:[],flags:{}})}function S(e,n,r,o){try{const n=t.createElement("script");n.nonce=e,n.setAttribute("type","text/javascript"),n.innerHTML=`(function(element){${r}})(document.querySelector('${o}'));`,t.body.appendChild(n)}catch(n){}}const I=new Set([n.JS,n.CssInsert]),w={cache:{},getItem(e,t){let n=this.cache[e];n||(n=this.cache[e]={});let r=n[t.selector];r||(r=n[t.selector]={});let o=r[t.value];return o||(o=r[t.value]=new Set),o},has(e,t,n){return I.has(e)&&this.getItem(e,t).has(n)},add(e,t,n){return this.getItem(e,t).add(n)}};function R(e,n,r,o){const{selector:i,value:a}=r;if(!i||void 0===a)return;const s=function(e){return e?t.querySelector(e):void 0}(i);s?w.has(e,r,s)||(n(s,a,i),w.add(e,r,s)):o>0&&setTimeout((()=>R(e,n,r,o-1)),100)}function P(e,t,n,r){n.forEach((n=>R(e,t,n,r?100:0)))}const T={};let k,j=0;const C=P.bind(null,n.TextInsert,((e,t)=>e.textContent===t||(e.textContent=t))),E=P.bind(null,n.Href,((e,t)=>e.getAttribute("href")===t.trim()||e.setAttribute("href",t.trim()))),L=P.bind(null,n.ImageSrc,((e,t)=>e.getAttribute("src")===t.trim()||e.setAttribute("src",t.trim()))),O=P.bind(null,n.Html,((e,t)=>e.innerHTML===t||(e.innerHTML=t))),_=P.bind(null,n.CssInsert,(function(e,t){try{const n=t.trim().split(";");for(const t of n)if(t){const[n,r]=v(t,":");n&&void 0!==r&&(e.style[n]=r)}}catch(e){}})),A=(e,t,r)=>{P(n.JS,S.bind(null,t),e,r)};let H=!1;function $(t,n){return new Promise((r=>{var o;const i=v(t,".")[1];if(i)try{null===(o=e.ym)||void 0===o||o.call(e,i,"experiments",n)}catch(e){}!function o(){if(!i)return void console.error(`Bad clientId = ${t}`);const a=function(t){var n,r;const o=e[`yaCounter${t}`];if(!o)try{const o=(null===(r=null===(n=e.Ya)||void 0===n?void 0:n._metrika)||void 0===r?void 0:r.counters)||{};return o[Object.keys(o).find((e=>0===e.indexOf(`${t}:`)))||""]}catch(e){}return o}(i);if(a){try{a.experiments(n)}catch(e){}H=!0,r(!0)}else setTimeout(o,10)}()}))}function J(t,n=e.location.href){if(0===t.length)return;const r=new URL(n),i=r.pathname;r.pathname="";const a=new URL(t,r.toString());a.protocol=r.protocol,a.hostname=r.hostname;let s=0,c=!0;return r.searchParams.forEach(((e,t)=>{t!==o.ExpFlags&&t!==o.RedirParam&&(s++,a.searchParams.has(t)?c&&a.searchParams.get(t)!==e&&(c=!1):a.searchParams.set(t,e))})),c&&(c=s===Array.from(a.searchParams.keys()).length),c&&i.replace(p,"")===a.pathname.replace(p,"")?void 0:a}function N(t,n,i,a){if(n)switch(t.storeRedirParam){case!0:case r.LocalStorage:const t={experiments:n,ts:Date.now(),target:i.toString()};e.localStorage.setItem(o.RedirParamNew,JSON.stringify(t));break;case r.Cookie:b(o.RedirParam,n,3e5);break;case r.GetParam:i.searchParams.set(o.RedirParam,n);break;default:a()}}function F(t,n,r){if("string"!=typeof r||0===r.length)return;let o=r;try{const i=new URL(r,e.location.href);N(t,n,i,(()=>console.error("storeRedirParam is required"))),o=i.toString()}catch(e){console.error(e)}return o}function q(e,t,n){let r=6,o=0;!function e(){var i;try{for(;o<n.length;o++)null===(i=n[o])||void 0===i||i.call(null,t)}catch(t){r-- >0?setTimeout(e,50):console.error(t)}}(),function(e){if(!g||"object"!=typeof g)return;!0===g[e]&&(g[e]=!1);const{callback:t}=g;if(t){for(const[e,t]of Object.entries(g)){const[n,r]=v(e,".");if(n&&r&&!0===t&&n.length>0&&!isNaN(Number(r)))return}setTimeout(t,0)}}(e)}function U(n,i,u,p){if("string"!=typeof n)throw new Error("clientId: should be string");c[n]=!0;let g=10;const v=new URL(m),S=v.searchParams;S.set("client_id",String(n)),S.set("url",e.location.href),S.set("i",i||y(d)||""),u&&S.set("client_features",JSON.stringify(u));const I=v.toString(),w=s[I];if(w)return p(w);const R=a[I]||(a[I]=[]);if(R.push(p),R.length>1)return;function P(){if(s[I])return;const e={flags:{},i,experiments:void 0,prepareUrl:e=>"string"==typeof e?e:void 0};s[I]=e,$(n,"wSIKtymTfos,"),R&&q(n,e,R)}const U=setTimeout(P,5e3);function G(a){const c=f[n]||l,{flags:u,cssInsert:m,textInsert:p,hrefInsert:g,jsInsert:v,imageSrcInsert:S,redirect:w,htmlReplace:P}=x(a.flags,c),M=Object.assign(Object.assign({},a),{flags:u,prepareUrl:F.bind(null,c,a.experiments)});a.i&&(i=a.i);const G=function(t){try{switch(t){case r.Cookie:{const e=y(o.RedirParam);return b(o.RedirParam,"",-h),e}case r.GetParam:{const t=new URL(e.location.href),n=t.searchParams;if(n.has(o.RedirParam)){const r=n.get(o.RedirParam);return n.delete(o.RedirParam),e.history.replaceState(e.history.state,"",t.toString()),r||void 0}}case r.LocalStorage:case!0:{const t=e.localStorage.getItem(o.RedirParamNew);let n;if(t){const e=JSON.parse(t);e.ts>Date.now()-3e5&&(n=e.experiments)}else n=e.localStorage.getItem(o.RedirParam)||void 0;return e.localStorage.removeItem(o.RedirParam),e.localStorage.removeItem(o.RedirParamNew),n||void 0}}}catch(e){}}(c.storeRedirParam);function D(e=!1){P.length&&O(P,e),g.length&&E(g,e),S.length&&L(S,e),p.length&&C(p,e),m.length&&_(m,e),v.length&&A(v,c.nonce,e)}function W(){m.length&&function(e,n){const r=[];for(const{selector:t,value:n}of e){const e=n.trim();r.push(`${t} {${e}}`)}try{const e=t.createElement("style");e.nonce=n,e.setAttribute("type","text/css"),e.textContent=r.join("\n").replace(/;/g," !important;"),t.body.appendChild(e)}catch(e){}}(m,c.nonce),c.enableWatch&&function(n,r){var o;null===(o=T[n])||void 0===o||o.disconnect();const i=new e.MutationObserver((()=>{j++>=5||(r(),clearTimeout(k),k=setTimeout((()=>{j=0}),0))}));T[n]=i,i.observe(t.body,{subtree:!0,childList:!0,characterData:!0,attributes:!0,attributeFilter:["class"]})}(n,(()=>D())),D(!c.enableWatch),R&&q(n,M,R)}G&&G!==a.experiments?$(n,G).then((()=>$(n,a.experiments))):$(n,a.experiments),clearTimeout(U),s[I]=M,M.i&&b(d,M.i),w.length&&function(t,n,r){let o;for(const e of t)if(o=J(e),o)break;if(!o)return!1;let i=0;try{N(n,r,o,(()=>i=n.metrikaTimeout))}catch(e){i=n.metrikaTimeout}const a=o.toString();let s,c;function l(){clearTimeout(c),clearTimeout(s),e.location.replace(a)}return c=setTimeout(l,i),function e(){H?l():s=setTimeout(e,10)}(),!0}(w,c,a.experiments)||(e.requestAnimationFrame?e.requestAnimationFrame(W):setTimeout(W,1))}M(I,G,(function e(){if(--g>0)return M(I,G,e);clearTimeout(U),P()}))}function M(e,t,n){const r=new XMLHttpRequest;return r.open("GET",e),r.addEventListener("load",(function(){if(200!==r.status)n(r.statusText);else try{const e=JSON.parse(r.responseText);t(e)}catch(e){e instanceof Error&&n(e.message)}})),r.addEventListener("error",(()=>n(r.statusText))),r.send()}const G={[i.Init]:(e,t,n,r)=>{U(e,t,n,(e=>r&&r(e)))},[i.Flags]:(e,t,n,r)=>{U(e,t,n,(e=>r&&r(e.flags)))},[i.Experiments]:(e,t,n,r)=>{U(e,t,n,(e=>r&&r(e.experiments)))},[i.Param]:(e,t,n,r)=>{U(e,t,n,(e=>r&&r(e.i)))},[i.SetConfig]:(e,t,n,r)=>{D(e,n),r&&r()},[i.GetConfig]:(e,t,n,r)=>{const o=f[e]||l,i=Object.assign({},o);delete i.nonce,r&&r(i)}};function D(e,t){var n;if("object"==typeof t){const r=f[e]||(f[e]=Object.assign({},l)),o=Object.keys(t);for(const e of o)if(e in r){const o=e,i=t[o];(null===(n=u[o])||void 0===n?void 0:n.includes(typeof i))&&(r[o]=i)}}}function W(e,t,n,r,o){if("object"==typeof e)return function(e){const{clientId:t,config:n}=e;if(!t)throw new Error("clientId is required");D(t,n),G.init(t,e.i,e.clientFeatures,e.callback)}(e);if(!t)throw new Error("method not specified");if(!(t in G))throw new Error("unknown method");"function"==typeof r&&(o=r,r={}),"function"==typeof n&&(o=n,n=void 0),"object"==typeof n&&(r=n,n=void 0),r||(r={}),G[t](e,n,r,o)}e.ymab&&(Array.isArray(e.ymab.a)&&e.ymab.a.forEach((e=>W.apply(null,e))),"object"==typeof e.ymab.antiFlicker&&(g=e.ymab.antiFlicker)),W.inited=!0,e.ymab=W,function(e,t){let n;!function(e){e.AppendRemote="appendremote"}(n||(n={}));const r=["ru","ua","by","kz","com","com.tr"];const o={};function i(e){const t=new URL(e),{hostname:n,protocol:o}=t,i=(null==n?void 0:n.split("."))||[];"test"===i[1]&&i.splice(1,1);const[a,s,...c]=i,l=c.join(".");return"https:"===o&&"ab"===a&&"yandex"===s&&-1!==r.indexOf(l)}e.addEventListener("message",(function(e){const r=e.origin;if(!r||!i(r))return;const a=function(e){if(!e)return null;if("string"!=typeof e)return e;try{return JSON.parse(e)}catch(e){return null}}(e.data);if(a&&c[a.clientId]&&a.type===n.AppendRemote)!function(e){if(!e||!function(e){return e&&/^https:\/\/abt\.s3\.yandex\.net\/(\w|-|\/|(\.)(?!\.))+\.js$/.test(e)}(e)||o[e])return;const n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src=e;const r=t.head;r.insertBefore(n,r.firstChild),o[e]=!0}(a.url)}))}(e,t)}(window,document);